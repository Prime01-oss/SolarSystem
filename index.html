<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samar's Planetarium</title>
    
    <link rel="icon" type="image/png" href="favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="home-style.css"> 
</head>
<body>

    <div id="loading-screen">
        <canvas id="loader-canvas"></canvas>
        
        <div class="loader-content">
            
            <div class="loader-logo-container">
                <img src="assets/images/logo-animation.gif" alt="Booting..." class="loader-logo">
            </div>
            
            <h2 id="loader-greeting"></h2>
            <p id="loader-text"></p>
            
            <div id="start-button-container">
                <button id="start-button">START</button>
            </div>
            </div>
        
        <audio id="hyperdrive-sound" preload="auto" style="display: none;">
            <source src="assets/sounds/hyperdrive.mp3" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>
    </div>
    <main class="home-container">
        
        <img src="assets/images/logo-animation.gif" alt="Animated Solar System" class="animated-logo">

        <h1 class="main-title main-title-home">Samar's Planetarium</h1>
        <p class="subtitle">An interactive 3D simulation of our cosmic neighborhood.</p>

        <nav class="nav-grid">
            <a href="simulation.html" class="nav-card">
                <div class="card-icon">ü™ê</div>
                <h2 data-original-text="Explore Solar System">Explore Solar System</h2>
                <p>Load the interactive 3D simulation. Fly between planets and view detailed info.</p>
            </a>

            <a href="missions.html" class="nav-card">
                <div class="card-icon"><img src="favicon.png" alt="Rocket"></div>
                <h2 data-original-text="Famous Missions">Famous Missions</h2>
                <p>Learn about humanity's greatest achievements, from the Voyager probes to the James Webb telescope.</p>
            </a>

            <a href="history.html" class="nav-card">
                <div class="card-icon">üåå</div>
                <h2 data-original-text="The History">The History</h2>
                <p>A brief story of cosmic evolution, from the Big Bang to the formation of our solar system.</p>
            </a>
        </nav>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- 1. WORLD-CLASS LOADER LOGIC ---
            
            const loadingScreen = document.getElementById('loading-screen');
            const homeContainer = document.querySelector('.home-container');
            const loaderGreeting = document.getElementById('loader-greeting');
            const loaderText = document.getElementById('loader-text');
            const canvas = document.getElementById('loader-canvas');
            const ctx = canvas.getContext('2d');
            
            // ‚úÖ Get the audio and new button element
            const hyperdriveSound = document.getElementById('hyperdrive-sound');
            const startButton = document.getElementById('start-button');
            const startButtonContainer = document.getElementById('start-button-container');

            // --- Initial Setup (Unchanged) ---
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            window.addEventListener('resize', () => {
                if (loadingScreen.classList.contains('hidden')) return;
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });

            const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

            // --- Premium "No-Jitter" Typewriter (Modified to accept fixed text first) ---
            async function premiumType(element, text, delay = 50) {
                // ... (Implementation remains the same as previous) ...
                const newHTML = text.split('').map((letter, index) => {
                    const char = (letter === ' ') ? '&nbsp;' : letter;
                    return `<span class="letter" style="transition-delay: ${index * (delay / 1000)}s">${char}</span>`;
                }).join('');
                
                element.innerHTML = newHTML;
                
                requestAnimationFrame(() => {
                    element.classList.add('visible');
                });

                await sleep(text.length * delay + 500);
                element.classList.remove('visible');
                await sleep(300);
            }

            // --- Starfield Animation (Unchanged) ---
            let stars = [];
            const numStars = 500;
            let warpSpeed = 5; 
            let animationFrameId_Loader;

            function createStar() {
                return {
                    x: (Math.random() - 0.5) * canvas.width * 0.8,
                    y: (Math.random() - 0.5) * canvas.height * 0.8,
                    z: Math.random() * 1000
                };
            }
            for (let i = 0; i < numStars; i++) { stars[i] = createStar(); }

            function drawStarfield() {
                // ... (Implementation remains the same as previous) ...
                if (canvas.width !== window.innerWidth || canvas.height !== window.innerHeight) {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                }
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.save();
                ctx.translate(canvas.width / 2, canvas.height / 2);

                for (let i = 0; i < numStars; i++) {
                    let star = stars[i];
                    star.z -= warpSpeed;
                    if (star.z <= 0) {
                        stars[i] = createStar();
                        star = stars[i];
                    }
                    const k = 128 / star.z;
                    const px = star.x * k;
                    const py = star.y * k;
                    const size = (1 - star.z / 1000) * 4;
                    const alpha = Math.min(0.8, (1 - star.z / 1000) * (warpSpeed / 8));
                    ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                    ctx.beginPath();
                    ctx.arc(px, py, size, 0, Math.PI * 2);
                    ctx.fill();
                }
                ctx.restore();
                animationFrameId_Loader = requestAnimationFrame(drawStarfield);
            }

            // Function to just skip the loader (Unchanged)
            function skipLoader() {
                loadingScreen.classList.add('hidden');
                homeContainer.classList.add('visible');
            }
            
            // --- NEW: Boot Sequence Logic (Now independent) ---
            async function bootSequence() {
                // Hide the start button
                if (startButtonContainer) {
                    startButtonContainer.style.opacity = '0';
                    await sleep(300); // Wait for fade out
                    startButtonContainer.style.display = 'none';
                }
                
                // Reset to blank typewriter mode
                loaderGreeting.textContent = '';
                loaderText.textContent = '';
                
                // Start the main boot sequence text and audio
                await sleep(200);
                await premiumType(loaderGreeting, "Welcome Aboard, Traveler!", 70);
                
                await premiumType(loaderText, "Calibrating Nav-Com...", 30);
                await sleep(200);
                await premiumType(loaderText, "Engaging Warp Drive...", 30);
                
                // ‚úÖ Play the full sound effect here - guaranteed to work after click
                try {
                    hyperdriveSound.volume = 1.0; 
                    hyperdriveSound.play();
                } catch (e) {
                    console.error("Audio Play Error:", e);
                }

                warpSpeed = 25; // <<< THE "WOAH" MOMENT
                await sleep(1200); 
                
                // ‚úÖ Stop and reset the sound after the main warp moment
              

                await premiumType(loaderGreeting, "Strap In.", 70);
                await sleep(200);
                await premiumType(loaderText, "Landing Sequence Initiated...", 30);
                
                await premiumType(loaderText, "Arriving at Samar's Planetarium...", 30);
                  try {
                    hyperdriveSound.pause();
                    hyperdriveSound.currentTime = 0; 
                } catch (e) {
                    // Fallback
                }
                
                await sleep(200);
                
                // 1. Hide the loading screen
                loadingScreen.classList.add('hidden');
                
                // 2. Show the homepage
                homeContainer.classList.add('visible');
                
                // 3. Stop the loader animation loop
                cancelAnimationFrame(animationFrameId_Loader);
                
                // 4. SET THE SESSION STORAGE FLAG
                sessionStorage.setItem('hasLoaded', 'true');
            }
            
            // --- NEW: Start Logic (Waiting for Click) ---
            
            // This function runs on initial load
            function startLoader() {
                // Check sessionStorage first
                if (sessionStorage.getItem('hasLoaded')) {
                    skipLoader(); 
                    return;
                }
                
                // Start the starfield animation immediately
                drawStarfield();
                
                // Set the initial greeting/prompt
                loaderGreeting.classList.add('visible');
                loaderText.classList.add('visible');
                startButtonContainer.style.opacity = '1';
                
                // Add the click listener to start the sequence
                if (startButton) {
                    startButton.addEventListener('click', () => {
                        // Remove the listener to prevent multiple clicks
                        startButton.removeEventListener('click', bootSequence);
                        
                        // Execute the sequence now that we have a user gesture
                        bootSequence();
                    });
                }
            }

            startLoader();
            // --- END NEW: Start Logic ---


            // --- 2. HOMEPAGE ANIMATION LOGIC (Unchanged) ---
            
            // --- Homepage Title Letter Animation ---
            const title = document.querySelector('.main-title');
            if (title) {
                const text = title.textContent;
                const staggerDelay = 0.03;
                const newHTML = text.split('').map((letter, index) => {
                    let char = (letter === ' ') ? '&nbsp;' : letter;
                    return `<span class="letter" style="transition-delay: ${index * staggerDelay}s">${char}</span>`;
                }).join('');
                title.innerHTML = newHTML;
            }

            // --- "NO-JITTER" SCRAMBLER CLASS ---
            class PremiumScrambler {
                // ... (Implementation remains the same as previous) ...
                constructor(element) {
                    this.el = element;
                    this.originalText = element.dataset.originalText;
                    this.chars = '_<>$*#';
                    this.animationId = null;
                    this.lastUpdateTime = 0;
                    this.charArray = this.originalText.split('');
                    this.revealProgress = 0;
                    this.revealSpeed = 400; 
                    this.jumbleSpeed = 50; 
                    this.lastJumbleTime = 0;
                }
                animate(currentTime) {
                    if (!this.animationId) return; 
                    const deltaTime = currentTime - this.lastUpdateTime;
                    this.revealProgress += deltaTime;
                    const jumbleDelta = currentTime - this.lastJumbleTime;
                    let needsJumble = false;
                    if (jumbleDelta > this.jumbleSpeed) {
                        needsJumble = true;
                        this.lastJumbleTime = currentTime;
                    }
                    const revealedCount = Math.floor((this.revealProgress / this.revealSpeed) * this.originalText.length);
                    for (let i = 0; i < this.originalText.length; i++) {
                        if (i < revealedCount) {
                            this.charArray[i] = this.originalText[i];
                        } 
                        else {
                            if (needsJumble) {
                                if (this.originalText[i] === ' ') {
                                    this.charArray[i] = ' ';
                                } else {
                                    this.charArray[i] = this.chars[Math.floor(Math.random() * this.chars.length)];
                                }
                            }
                        }
                    }
                    this.el.textContent = this.charArray.join('');
                    if (revealedCount >= this.originalText.length) {
                        this.stop(); 
                    } else {
                        this.lastUpdateTime = currentTime;
                        this.animationId = requestAnimationFrame((t) => this.animate(t));
                    }
                }
                start() {
                    this.revealProgress = 0;
                    this.lastUpdateTime = performance.now();
                    this.lastJumbleTime = performance.now();
                    this.charArray = this.originalText.split('').map((char) => 
                        char === ' ' ? ' ' : this.chars[Math.floor(Math.random() * this.chars.length)]
                    );
                    if (this.animationId) {
                        cancelAnimationFrame(this.animationId);
                    }
                    this.animationId = requestAnimationFrame((t) => this.animate(t));
                }
                stop() {
                    if (this.animationId) {
                        cancelAnimationFrame(this.animationId);
                    }
                    this.animationId = null;
                    this.el.textContent = this.originalText;
                }
            }
            
            const cards = document.querySelectorAll('.nav-card');
            cards.forEach(card => {
                const titleElement = card.querySelector('h2');
                if (titleElement) { 
                    const scrambler = new PremiumScrambler(titleElement);
                    card.addEventListener('mouseenter', () => scrambler.start());
                    card.addEventListener('mouseleave', () => scrambler.stop());
                }
            });
        });
    </script>
</body>
</html>